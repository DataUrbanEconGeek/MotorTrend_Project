---
title: "Motor Trend Project"
author: "Andrew Rosa"
date: "11/12/2016"
output: 
        html_document:
                includes:
                        in_header: head.html
                css: style.css
---

### Background

The 1974 issue of Motor Trend US magazine contained a data-set on the fuel consumption and ten different aspects of design and performance for 32 automobiles. The goals of this project is to create a prediction model for figuring out an automobile's fuel efficincy or how much miles per gallon(mpg) does the automobile get. 

### First

We should take a look at the data. No need to load the data-set into the global environment, as R already has it. We'll use the function `str()` to get an overlook of the data.

```{r}
str(mtcars)
```

We can see that all of the variables in the data-set are numeric. Transmission should be a cator though: 0 marks automatic, and 1 marks manual. We'll need to fix this. We also don't see the names of the automobiles. This is because they are the row names of the data-set. Let's take a look at this as well. 

```{r}
mtcars$am <- factor(mtcars$am)
rownames(mtcars)
```

### Exploritory Visualization

Lets take a look at some of the quantitative variabls with density plots overlayed with histrograms to get an idea of the distrobutions.

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(gridExtra)

var_names <- c("mpg", "disp", "hp", "drat", "wt")
plot_list<- list()
for(i in var_names){
        temp_plot <- ggplot(mtcars, aes_string(x = i)) +
                geom_density(fill = I("#00BFC4"), col = "#00BFC4", alpha = 0.5) +
                geom_histogram(aes(fill  = I("#F8766D"), y = ..density..), alpha = 0.9) 
        plot_list[[paste0(i, 1)]] <- temp_plot
}
grid.arrange(grobs = plot_list, ncol = 2)
```

Here we can see that most of the vairables are right skew. Displacement and rear axle ratio are distincivly bimodal. The other vairiabls are closer to being unimodal. We should also take note that there are outliers in each variable. It may be a good idea to look at the natural logarithm of some of these variabls. This will help bring in the outliers, and alter the distrobutions. 

```{r echo=FALSE, warning=FALSE, message=FALSE}
var_names2 <- c("mpg", "disp", "hp", "drat", "wt")
plot_list2<- list()
for(i in var_names2){
        temp_plot <- ggplot(mtcars, aes_string(x = sprintf("log(%s)", i))) +
                geom_density(fill = I("#00BFC4"), col = "#00BFC4", alpha = 0.5) +
                geom_histogram(aes(fill  = I("#F8766D"), y = ..density..), alpha = 0.9) 
        plot_list2[[paste0(i, 1)]] <- temp_plot
}
grid.arrange(grobs = plot_list2, ncol = 2)
```

The distrobution for miles per gallon and hourseporwer are much more evenly skewd. Weight is now skewed further to the left than originally. Displacement's distrobution is now reversed, and the rear axel ration has bearly changed. 

Now it's time to look at how each variable effects miles per gallon. We'll start with simple scatter plots and the associated correlation coefficent. The correlation coefficent is used to represent the linear dependence of two variables. The number can lie within the range of negative one to one. A negative one would indicate a perfect negative realtionship, a zero indicates no correlation, and a positive one is a perfect positive relationship. The correlation coeffcent is calculated by dividing the covariance of the two variabls by the product of standard deviation of the variables. The equation is: $\mathbf {r} = \frac{cov(A,B)}{ \left( S_A \times S_B \right)}$

```{r echo=FALSE}
var_names3 <- c("disp", "hp")
plot_list3 <- list()
for(i in var_names3){
       temp_plot <- ggplot(mtcars, aes_string(x = i)) +
                        geom_point(aes(y = mpg)) +
                        annotate("text", x=Inf, y = Inf,
                                label = paste0("cor: ", 
                                        round(cor(mtcars[,i], mtcars$mpg), 2)),
                                vjust=1, hjust=1, col = "#F8766D")
       temp_plot2 <- ggplot(mtcars, aes_string(x = i)) +
                        geom_point(aes(y = log(mpg))) +
                        annotate("text", x=Inf, y = Inf,
                                label = paste0("cor: ", 
                                        round(cor(mtcars[,i], log(mtcars$mpg)), 2)),
                                vjust=1, hjust=1, col = "#F8766D")
       temp_plot3 <- ggplot(mtcars, aes_string(x = sprintf("log(%s)", i))) +
                        geom_point(aes(y = log(mpg))) +
                        annotate("text", x=Inf, y = Inf,
                                label = paste0("cor: ", 
                                        round(cor(log(mtcars[,i]), log(mtcars$mpg)), 2)),
                                vjust=1, hjust=1, col = "#F8766D")
       plot_list3[[paste0(i, 1)]] <- temp_plot
       plot_list3[[paste0(i, 2)]] <- temp_plot2
       plot_list3[[paste0(i, 3)]] <- temp_plot3
}
grid.arrange(grobs = plot_list3, ncol = 3)
```

```{r echo=FALSE}
var_names4 <- c("drat", "wt")
plot_list4 <- list()
for(i in var_names4){
       temp_plot <- ggplot(mtcars, aes_string(x = i)) +
                        geom_point(aes(y = mpg)) +
                        annotate("text", x=Inf, y = Inf,
                                label = paste0("cor: ", 
                                        round(cor(mtcars[,i], mtcars$mpg), 2)),
                                vjust=1, hjust=1, col = "#F8766D")
       temp_plot2 <- ggplot(mtcars, aes_string(x = i)) +
                        geom_point(aes(y = log(mpg))) +
                        annotate("text", x=Inf, y = Inf,
                                label = paste0("cor: ", 
                                        round(cor(mtcars[,i], log(mtcars$mpg)), 2)),
                                vjust=1, hjust=1, col = "#F8766D")
       temp_plot3 <- ggplot(mtcars, aes_string(x = sprintf("log(%s)", i))) +
                        geom_point(aes(y = log(mpg))) +
                        annotate("text", x=Inf, y = Inf,
                                label = paste0("cor: ", 
                                        round(cor(log(mtcars[,i]), log(mtcars$mpg)), 2)),
                                vjust=1, hjust=1, col = "#F8766D")
       plot_list4[[paste0(i, 1)]] <- temp_plot
       plot_list4[[paste0(i, 2)]] <- temp_plot2
       plot_list4[[paste0(i, 3)]] <- temp_plot3
}
grid.arrange(grobs = plot_list4, ncol = 3)
```

From the charts here we see that when the natural logarithm is applied to a variable the correlation is strengthened. The exception is with the rear axel ratio, where the results become worse by applying the natural logarithm. This shouldn't be surprising, we saw little change in the distrobution of the rear axle ratio when a natural logarith was applied as well. 
It is now time to explore how miles per gallon interacts with catigoriagal variables. We'll use boxplots for this exploration. 

```{r echo=FALSE}
var_names5 <- c("cyl", "vs", "am", "gear", "carb")
plot_list5 <- list()
for(i in var_names5){
        temp_plot <- ggplot(mtcars, aes_string(x = sprintf("factor(%s)", i), y = "mpg")) +
                geom_boxplot() 
        plot_list5[[paste0(i, 1)]] <- temp_plot
}
grid.arrange(grobs = plot_list5, ncol = 2)
```

These boxplots make it really easy to understand the trends of the explanitory variables verses miles per gallons. As cylenders increase, miles per gallons decrease. We see that automobiles with straight engines or have manual transmitions usually get better miles per gallon than automobiles with V engines or that have automatic trasmitions. Now that we have a good understanding of how miles per gallon interects with the explanitory variables on simple singular level, lets start to combine them. 

### Multiple Regression

```{r}

model_1 <- lm(mpg ~ cyl + disp + hp + drat + wt + vs + am + gear + carb, data = mtcars)
summary(model_1)
prediction_1 <- predict(model_1, newdata = mtcars)
pred_diff_1 <- with(mtcars, mpg - prediction_1)
mean(pred_diff_1 ^ 2)
```

```{r}
model_2 <- lm(mpg ~ cyl + log(disp) + log(hp) + drat + log(wt) + vs + am + gear + carb, data = mtcars)
summary(model_2)
prediction_2 <- predict(model_2, newdata = mtcars)
pred_diff_2 <- with(mtcars, mpg - prediction_2)
mean(pred_diff_2 ^ 2)
```

```{r}
model_3 <- lm(mpg ~ cyl + log(disp) * log(hp) * log(wt) * drat + vs + am + gear + carb, data = mtcars)
summary(model_3)
prediction_3 <- predict(model_3, newdata = mtcars)
pred_diff_3 <- with(mtcars, mpg - prediction_3)
mean(pred_diff_3 ^ 2)
```



